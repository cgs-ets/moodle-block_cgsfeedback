{"version":3,"file":"control.min.js","sources":["../src/control.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_cgsfeedback/control module\n *\n * @package   block_cgsfeedback\n * @category  output\n * @copyright 2023 onwards Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_cgsfeedback/control\n */\ndefine(['core/url', 'core/ajax', 'core/log', 'core/templates'],\n    function (URL, Ajax, Log, Templates) {\n        'use strict';\n\n        /**\n         * Initializes the block controls.\n         */\n        function init(instanceid) {\n            Log.debug('block_cgsfeedback/control: initializing controls of the cgsfeedback block');\n            console.log(instanceid);\n            var section = document.getElementById(instanceid)\n\n            if (section == null) {\n                Log.debug('block_cgsfeedback/control: section not found!');\n                return;\n            }\n\n            // Change the images URLS to be picked up the parentview plugin\n            encodeURL();\n            //\n            const expandIcon = document.querySelectorAll('.cgsfeedback-expand-icon');\n            expandIcon.forEach(icon => icon.addEventListener('click', expandTable));\n\n            const collapseIcon = document.querySelectorAll('.cgsfeedback-collapse-icon');\n            collapseIcon.forEach(icon => icon.addEventListener('click', collapseTable));\n\n            // Show table\n            function expandTable(e) {\n                console.log(\"expandTable\");\n                console.log(e.target.getAttribute('data-courseid'));\n                courseid = e.target.getAttribute('data-courseid');\n                userid = document.querySelector(\".cgsfeedback-course-container\").getAttribute('data-userid');\n                const table = document.getElementById(`cgsfeedback-activities-container-${courseid}`);\n                console.log(table);\n\n                if (table == null) {\n                    // Show the loading\n                    document.querySelector(`.loading-course-${courseid}-modules`).removeAttribute('hidden');\n                    // Get the assessments dinamically.\n                    Ajax.call([\n                        {\n                            methodname: 'block_cgsfeedback_get_modules',\n                            args: {\n                                courseid: courseid,\n                                userid: userid,\n                            },\n                            done: function (response) {\n                                $(`.loading-course-${courseid}-modules`).replaceWith(response.html);\n                            },\n                            fail: function (reason) {\n                                console.log(reason);\n                            }\n                        }\n                    ])\n                } else {\n                    document.getElementById(`cgsfeedback-activities-container-${courseid}`).removeAttribute('hidden');\n                }\n\n                // Hide expand icon\n                document.querySelector(`.cgsfeedback-expand-icon[data-courseid=\"${courseid}\"]`).setAttribute('hidden', true);\n                // Show collapse icon\n                document.querySelector(`.cgsfeedback-collapse-icon[data-courseid=\"${courseid}\"]`).removeAttribute('hidden');\n            }\n\n            // Hide table\n            function collapseTable(e) {\n                console.log(\"collapseTable\");\n                console.log(e.target.getAttribute('data-courseid'));\n                courseid = e.target.getAttribute('data-courseid');\n                const table = document.getElementById(`cgsfeedback-activities-container-${courseid}`);\n                table.setAttribute('hidden', true); // Hide table\n                document.querySelector(`.cgsfeedback-collapse-icon[data-courseid=\"${courseid}\"]`).setAttribute('hidden', true);\n                // Show collapse icon\n                document.querySelector(`.cgsfeedback-expand-icon[data-courseid=\"${courseid}\"]`).removeAttribute('hidden');\n            }\n\n            function encodeURL() {\n                const images = document.querySelectorAll(\"section#inst32  img\");\n\n                images.forEach(image => {\n                    const urlEncoded = encodeURIComponent(image.getAttribute('src'));\n                    console.log(urlEncoded);\n                    const userid = document.querySelector('.cgsfeedback-course-container').getAttribute('data-userid');\n                    const newURL = URL.relativeUrl('/local/parentview/get.php', {\n                        addr: urlEncoded,\n                        user: userid\n                    });\n\n                    image.setAttribute('src', newURL);\n\n                })\n\n            }\n\n        }\n\n        return {\n            init: init\n        };\n    });"],"names":["define","URL","Ajax","Log","Templates","init","instanceid","expandTable","e","console","log","target","getAttribute","courseid","userid","document","querySelector","table","getElementById","removeAttribute","call","methodname","args","done","response","$","replaceWith","html","fail","reason","setAttribute","collapseTable","debug","querySelectorAll","forEach","image","urlEncoded","encodeURIComponent","newURL","relativeUrl","addr","user","icon","addEventListener"],"mappings":";;;;;;;;AA2BAA,mCAAO,CAAC,WAAY,YAAa,WAAY,mBACzC,SAAUC,IAAKC,KAAMC,IAAKC,iBA+Ff,CACHC,cA1FUC,qBAoBDC,YAAYC,GACjBC,QAAQC,IAAI,eACZD,QAAQC,IAAIF,EAAEG,OAAOC,aAAa,kBAClCC,SAAWL,EAAEG,OAAOC,aAAa,iBACjCE,OAASC,SAASC,cAAc,iCAAiCJ,aAAa,mBACxEK,MAAQF,SAASG,0DAAmDL,WAC1EJ,QAAQC,IAAIO,OAEC,MAATA,OAEAF,SAASC,wCAAiCH,sBAAoBM,gBAAgB,UAE9EjB,KAAKkB,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CACFT,SAAUA,SACVC,OAAQA,QAEZS,KAAM,SAAUC,UACZC,4BAAqBZ,sBAAoBa,YAAYF,SAASG,OAElEC,KAAM,SAAUC,QACZpB,QAAQC,IAAImB,aAKxBd,SAASG,0DAAmDL,WAAYM,gBAAgB,UAI5FJ,SAASC,gEAAyDH,gBAAciB,aAAa,UAAU,GAEvGf,SAASC,kEAA2DH,gBAAcM,gBAAgB,mBAI7FY,cAAcvB,GACnBC,QAAQC,IAAI,iBACZD,QAAQC,IAAIF,EAAEG,OAAOC,aAAa,kBAClCC,SAAWL,EAAEG,OAAOC,aAAa,iBACnBG,SAASG,0DAAmDL,WACpEiB,aAAa,UAAU,GAC7Bf,SAASC,kEAA2DH,gBAAciB,aAAa,UAAU,GAEzGf,SAASC,gEAAyDH,gBAAcM,gBAAgB,UAjEpGhB,IAAI6B,MAAM,6EACVvB,QAAQC,IAAIJ,YAGG,MAFDS,SAASG,eAAeZ,aAmEnBS,SAASkB,iBAAiB,uBAElCC,SAAQ,SAAAC,WACLC,WAAaC,mBAAmBF,MAAMvB,aAAa,QACzDH,QAAQC,IAAI0B,gBACNtB,OAASC,SAASC,cAAc,iCAAiCJ,aAAa,eAC9E0B,OAASrC,IAAIsC,YAAY,4BAA6B,CACxDC,KAAMJ,WACNK,KAAM3B,SAGVqB,MAAML,aAAa,MAAOQ,WApEfvB,SAASkB,iBAAiB,4BAClCC,SAAQ,SAAAQ,aAAQA,KAAKC,iBAAiB,QAASpC,gBAErCQ,SAASkB,iBAAiB,8BAClCC,SAAQ,SAAAQ,aAAQA,KAAKC,iBAAiB,QAASZ,mBAXxD5B,IAAI6B,MAAM"}