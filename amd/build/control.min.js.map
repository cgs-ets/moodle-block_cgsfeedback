{"version":3,"file":"control.min.js","sources":["../src/control.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_cgsfeedback/control module\n *\n * @package   block_cgsfeedback\n * @category  output\n * @copyright 2023 onwards Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_cgsfeedback/control\n */\ndefine(['core/url', 'core/ajax', 'core/log', 'core/templates'],\n    function (URL, Ajax, Log, Templates) {\n        'use strict';\n\n        /**\n         * Initializes the block controls.\n         */\n        function init(instanceid) {\n            Log.debug('block_cgsfeedback/control: initializing controls of the cgsfeedback block');\n            console.log(instanceid);\n            var section = document.getElementById(instanceid)\n\n            if (section == null) {\n                Log.debug('block_cgsfeedback/control: section not found!');\n                return;\n            }\n\n            // Change the images URLS to be picked up the parentview plugin\n            encodeURL(instanceid);\n            //\n            const expandIcon = document.querySelectorAll('.cgsfeedback-expand-icon');\n            expandIcon.forEach(icon => icon.addEventListener('click', expandTable));\n\n            const collapseIcon = document.querySelectorAll('.cgsfeedback-collapse-icon');\n            collapseIcon.forEach(icon => icon.addEventListener('click', collapseTable));\n\n            // Show table\n            function expandTable(e) {\n                courseid = e.target.getAttribute('data-courseid');\n                userid = document.querySelector(\".cgsfeedback-course-container\").getAttribute('data-userid');\n                const table = document.getElementById(`cgsfeedback-activities-container-${courseid}`);\n\n                if (table == null) {\n                    // Show the loading\n                    document.querySelector(`.loading-course-${courseid}-modules`).removeAttribute('hidden');\n                    // Get the assessments dinamically.\n                    Ajax.call([\n                        {\n                            methodname: 'block_cgsfeedback_get_modules',\n                            args: {\n                                courseid: courseid,\n                                userid: userid,\n                            },\n                            done: function (response) {\n                                $(`.loading-course-${courseid}-modules`).replaceWith(response.html);\n                              //  encodeURL(instanceid);\n                            },\n                            fail: function (reason) {\n                                console.log(reason);\n                            }\n                        }\n                    ])\n                } else {\n                    document.getElementById(`cgsfeedback-activities-container-${courseid}`).removeAttribute('hidden');\n                }\n\n                // Hide expand icon\n                document.querySelector(`.cgsfeedback-expand-icon[data-courseid=\"${courseid}\"]`).setAttribute('hidden', true);\n                // Show collapse icon\n                document.querySelector(`.cgsfeedback-collapse-icon[data-courseid=\"${courseid}\"]`).removeAttribute('hidden');\n            }\n\n            // Hide table\n            function collapseTable(e) {\n                console.log(\"collapseTable\");\n                console.log(e.target.getAttribute('data-courseid'));\n                courseid = e.target.getAttribute('data-courseid');\n                const table = document.getElementById(`cgsfeedback-activities-container-${courseid}`);\n                table.setAttribute('hidden', true); // Hide table\n                document.querySelector(`.cgsfeedback-collapse-icon[data-courseid=\"${courseid}\"]`).setAttribute('hidden', true);\n                // Show collapse icon\n                document.querySelector(`.cgsfeedback-expand-icon[data-courseid=\"${courseid}\"]`).removeAttribute('hidden');\n            }\n\n            function encodeURL(instanceid) {\n                const images = document.querySelectorAll(`section#${instanceid}  img`);\n\n                images.forEach(image => {\n                    const urlEncoded = encodeURIComponent(image.getAttribute('src'));\n                    console.log(urlEncoded);\n                    const userid = document.querySelector('.cgsfeedback-course-container').getAttribute('data-userid');\n                    const newURL = URL.relativeUrl('/local/parentview/get.php', {\n                        addr: urlEncoded,\n                        user: userid\n                    });\n\n                    image.setAttribute('src', newURL);\n\n                })\n\n            }\n\n        }\n\n        return {\n            init: init\n        };\n    });"],"names":["define","URL","Ajax","Log","Templates","init","instanceid","expandTable","e","courseid","target","getAttribute","userid","document","querySelector","getElementById","removeAttribute","call","methodname","args","done","response","$","replaceWith","html","fail","reason","console","log","setAttribute","collapseTable","debug","querySelectorAll","forEach","image","urlEncoded","encodeURIComponent","newURL","relativeUrl","addr","user","encodeURL","icon","addEventListener"],"mappings":";;;;;;;;AA2BAA,mCAAO,CAAC,WAAY,YAAa,WAAY,mBACzC,SAAUC,IAAKC,KAAMC,IAAKC,iBA6Ff,CACHC,cAxFUC,qBAoBDC,YAAYC,GACjBC,SAAWD,EAAEE,OAAOC,aAAa,iBACjCC,OAASC,SAASC,cAAc,iCAAiCH,aAAa,eAGjE,MAFCE,SAASE,0DAAmDN,YAItEI,SAASC,wCAAiCL,sBAAoBO,gBAAgB,UAE9Ed,KAAKe,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CACFV,SAAUA,SACVG,OAAQA,QAEZQ,KAAM,SAAUC,UACZC,4BAAqBb,sBAAoBc,YAAYF,SAASG,OAGlEC,KAAM,SAAUC,QACZC,QAAQC,IAAIF,aAKxBb,SAASE,0DAAmDN,WAAYO,gBAAgB,UAI5FH,SAASC,gEAAyDL,gBAAcoB,aAAa,UAAU,GAEvGhB,SAASC,kEAA2DL,gBAAcO,gBAAgB,mBAI7Fc,cAActB,GACnBmB,QAAQC,IAAI,iBACZD,QAAQC,IAAIpB,EAAEE,OAAOC,aAAa,kBAClCF,SAAWD,EAAEE,OAAOC,aAAa,iBACnBE,SAASE,0DAAmDN,WACpEoB,aAAa,UAAU,GAC7BhB,SAASC,kEAA2DL,gBAAcoB,aAAa,UAAU,GAEzGhB,SAASC,gEAAyDL,gBAAcO,gBAAgB,UA/DpGb,IAAI4B,MAAM,6EACVJ,QAAQC,IAAItB,YAGG,MAFDO,SAASE,eAAeT,uBAgEnBA,YACAO,SAASmB,mCAA4B1B,qBAE7C2B,SAAQ,SAAAC,WACLC,WAAaC,mBAAmBF,MAAMvB,aAAa,QACzDgB,QAAQC,IAAIO,gBACNvB,OAASC,SAASC,cAAc,iCAAiCH,aAAa,eAC9E0B,OAASpC,IAAIqC,YAAY,4BAA6B,CACxDC,KAAMJ,WACNK,KAAM5B,SAGVsB,MAAML,aAAa,MAAOQ,WApElCI,CAAUnC,YAESO,SAASmB,iBAAiB,4BAClCC,SAAQ,SAAAS,aAAQA,KAAKC,iBAAiB,QAASpC,gBAErCM,SAASmB,iBAAiB,8BAClCC,SAAQ,SAAAS,aAAQA,KAAKC,iBAAiB,QAASb,mBAXxD3B,IAAI4B,MAAM"}